{% extends "base.html" %}
{% load static %}
{% block title %}Z-Pay{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/zpay.css' %}">

<div class="container my-5">
    <div class="zpay-wrapper">
        <div class="zpay-card">

            <img src="{% static 'images/zpay.png' %}" class="zpay-logo">

            <h3 class="zpay-title">Z-Pay Secure Checkout</h3>

            <p class="zpay-subtitle">
                Order <strong>#{{ order.id }}</strong><br>
                Payable Amount: <strong>₹{{ payment.amount }}</strong>
            </p>

            <div class="zpay-loader">
                <div class="spinner"></div>
                <span>Waiting for confirmation…</span>
            </div>

            <form method="post" id="paymentForm">
                {% csrf_token %}
                <button type="submit" class="zpay-btn">
                    Simulate Payment
                </button>
            </form>

        </div>
    </div>
</div>

<!-- ===== POPUP MODAL ===== -->
<div id="paymentPopup" class="popup-overlay hidden">
    <div class="popup-card">
        <div id="popupIcon" class="popup-icon"></div>
        <h4 id="popupTitle"></h4>
        <p id="popupMessage"></p>
        <button onclick="closePopup()">Continue</button>
    </div>
</div>

<!-- ===== TOAST NOTIFICATION ===== -->
<div id="toast" class="toast hidden">
    <span id="toastIcon"></span>
    <span id="toastText"></span>
</div>

<!-- ===== CONFETTI ===== -->
<canvas id="confettiCanvas"></canvas>

<!-- ===== DJANGO MESSAGE BRIDGE (IMPORTANT) ===== -->
{% if messages %}
    {% for message in messages %}
        <div
            class="django-message"
            data-type="{{ message.tags }}"
            data-text="{{ message }}"
        ></div>
    {% endfor %}
{% endif %}

<script src="{% static 'js/zpay.js' %}"></script>
{% endblock %}
